# 📓 Dev-Log

✅ Уже сделано:

1. **Базовый бот (aiogram + DeepSeek API)**  
   - Загружается из `.env` (`TELEGRAM_TOKEN`, `DEEPSEEK_API_KEY`).  
   - Работает через aiogram, отвечает в Telegram.  
   - DeepSeek запросы теперь выполняются через `asyncio.to_thread`, не блокируя event loop.  

2. **Кастомные реакции**  
   - Приветствия (GREETINGS).  
   - Horny-реплики (HORNY).  
   - Оскорбления (INSULTS) + отдельные ответы на вопросительные оскорбления (QUESTION_INSULT_REPLIES).  

3. **Логика реакции**  
   - `is_greeting()` — проверяет короткие приветствия.  
   - `detect_insult_ai()` — классифицирует оскорбления через ИИ (direct, general, question, none).  
   - `detect_mood_ai()` — определяет настроение (sweet, horny, angry, playful).  
   - `detect_fetish_role()` — определяет роль в RP (active/passive/unknown).  
   - Если ничего не совпало → ответ генерирует DeepSeek.  

4. **JSON-конфиги**  
   - Все вынесены в `config/`.  
   - Загрузка через универсальную функцию `load_json()` с try/except.  
   - Ошибки парсинга или отсутствия файла логируются.  

5. **Личность и промпты**  
   - `personality.json` — фразы (GREETINGS, HORNY, INSULTS).  
   - `system_prompt.json` — системный промпт (строка или список).  
   - `rp_prompt.json` — промпт для RP.  
   - В system prompt прописаны правила поведения (мужской пол, мемы, horny-лексика, политика → «иди нахуй», RP в звёздочках и т.д.).  

6. **Оскорбления и триггеры**  
   - Расширенный словарь вынесен в `triggers.json`.  
   - Используется AI-классификация + свои списки.  

7. **Постобработка ответов DeepSeek**  
   - Бот может добавлять horny-фразы и эмодзи.  
   - HORNY включается:  
     • с 2-го ответа в RP (20% шанс, начало/конец).  
     • с 4-го ответа в чате (15% шанс, только конец).  
   - Иногда добавляется рандомный эмодзи (если реплика не заканчивается им).  

8. **Стартовые сообщения**  
   - `/start` → кастомное приветствие для новых пользователей.  
   - Для старых пользователей выдаётся случайный текст из `start_messages.json`.  

9. **RP-логика**  
   - Сообщения в *звёздочках* → RP-режим.  
   - Фетиши и роли учитываются в RP (active/passive).  
   - Есть анти-кринж фильтр для тела Экси (не писать «механический член» и т.п.).  

10. **Работа с медиа**  
    - Фото и документы image/* сохраняются в `images.json`.  
    - `/randomart` → случайный арт.  
    - Всё через `load_images()` / `save_images()`.  

11. **Админские команды (admin_commands.py)**  
    - `/listimages [N]` — список последних артов.  
    - `/removeimage id1,id2` — удалить арты.  
    - `/artcount` — количество артов.  
    - `/status` — аптайм, пользователи, счётчик ответов, последние логи.  
    - `/ping` — проверка доступности.  
    - `/ownhelp` — список админских команд.  
    - Импорт идёт ниже инициализации ядра (`# noqa: E402`).  

12. **Глобальное состояние (state.py)**  
    - `BOT_REPLY_COUNT`, `USERS`, `START_TIME`, `MOOD`.  
    - Типы проставлены (`int`, `List[int]`, `float`, `str`).  
    - Докстринг описывает назначение переменных.  

13. **Структура проекта**  
    - `config/` — JSON-файлы.  
    - `src/` планируется как основная папка для кода (main.py, handlers/, services/, core/).  
    - Логи перенесены в `logs/`.  
    - Подготовка к топ-структуре проекта (handlers, services, core).  

14. **Код-стайл и документация**  
    - Все функции снабжены docstring.  
    - Аннотации типов (`-> None`, `-> List[str]`, и т.п.).  
    - `ruff` и `mypy` готовы к прогону.  

---